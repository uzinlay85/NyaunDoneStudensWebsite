<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ညောင်တုန်းကျောင်းတိုက် သံဃာတော်များ</title>
    <link rel="icon" type="image/png" href="logo.png">
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pyidaungsu:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- Styles remain the same --- */
        body { font-family: 'Pyidaungsu', sans-serif; background-color: #f9fafb; color: #374151; }
        .container { max-width: 1280px; margin: auto; padding: 2rem; }
        .header { text-align: center; margin-bottom: 1rem; }
        .card { background-color: #ffffff; border-radius: 0.75rem; border: 1px solid #e5e7eb; padding: 1.5rem; box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05  ); margin-bottom: 1.5rem; }
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; min-width: 800px; }
        th, td { padding: 1rem 1.5rem; text-align: left; border-bottom: 1px solid #e5e7eb; vertical-align: middle; }
        thead { background-color: #f3f4f6; }
        th { font-weight: 700; color: #4b5563; text-transform: uppercase; font-size: 0.8rem; letter-spacing: 0.05em; }
        tbody tr:hover { background-color: #fafafa; }
        .filter-container { display: flex; flex-wrap: wrap; gap: 1rem; align-items: center; }
        input[type="text"], select { background-color: #ffffff; border: 1px solid #d1d5db; border-radius: 0.5rem; padding: 0.6rem 1rem; color: #374151; transition: border-color 0.2s, box-shadow 0.2s; font-family: 'Pyidaungsu', sans-serif; }
        input[type="text"]:focus, select:focus { outline: none; border-color: #60a5fa; box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3); }
        .button { padding: 0.75rem 1.5rem; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 700; transition: background-color 0.2s, transform 0.1s; }
        .button-sm { padding: 0.4rem 0.8rem; font-size: 0.8rem; }
        .button-primary { background-color: #3b82f6; color: white; }
        .button-primary:hover { background-color: #2563eb; }
        .button-secondary { background-color: #6b7280; color: white; }
        .button-secondary:hover { background-color: #4b5563; }
        .button-warning { background-color: #f59e0b; color: white; }
        .button-warning:hover { background-color: #d97706; }
        .button-danger { background-color: #ef4444; color: white; }
        .button-danger:hover { background-color: #dc2626; }
        .button-clear { background-color: transparent; color: #6b7280; border: 1px solid #d1d5db; padding: 0.6rem 1rem; }
        .button-clear:hover { background-color: #f3f4f6; }
        .button:active { transform: scale(0.98); }
        .total-count { display: flex; justify-content: space-around; text-align: center; }
        .total-count .count-item span { font-size: 0.9rem; color: #6b7280; }
        .total-count .count-item strong { display: block; font-size: 1.75rem; font-weight: 700; color: #1e40af; }
        .error { color: #991b1b; margin-top: 1rem; background-color: #fee2e2; padding: 1rem; border-radius: 0.5rem; border: 1px solid #fca5a5; }
        .text-center-cell { text-align: center; }
        .text-left-cell { text-align: left; }
        .transferred-student td { color: #9ca3af; text-decoration: line-through; }
        .transferred-student:hover { background-color: #fef2f2 !important; }
        #adminPanel { background-color: #fffbeb; border: 1px solid #fde68a; padding: 1.5rem; border-radius: 0.75rem; margin-bottom: 1.5rem; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
        .subject-checkboxes { display: flex; gap: 1rem; align-items: center; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="flex justify-center items-center gap-6">
                <img src="logo.png" alt="ကျောင်းတိုက် လိုဂို" class="h-16 w-16 object-contain">
                <div class="text-center">
                    <h1 class="text-3xl font-bold text-gray-800">ပါဠိတက္ကသိုလ်ညောင်တုန်းကျောင်းတိုက်</h1>
                    <p class="text-lg text-gray-500 mt-1" id="yearSubtitle">သံဃာစာရင်း</p>
                </div>
                <img src="logo.png" alt="ကျောင်းတိုက် လိုဂို" class="h-16 w-16 object-contain">
            </div>
        </div>

        <!-- Year Selector -->
        <div class="card flex justify-center">
            <div class="flex items-center gap-3">
                <label for="yearSelector" class="font-bold text-gray-700">ခုနှစ် ရွေးချယ်ရန်:</label>
                <select id="yearSelector">
                    <option value="2026">၂၀၂၆</option>
                    <option value="2025">၂၀၂၅</option>
                </select>
            </div>
        </div>
        
        <!-- Total Count Display -->
        <div class="card total-count" id="totalCount"></div>

        <!-- Admin Panel (Initially Hidden) -->
        <div id="adminPanel" style="display: none;">
            <!-- Admin Panel HTML remains the same -->
        </div>

        <!-- Filter section -->
        <div class="card">
            <!-- Filter HTML remains the same -->
        </div>

        <!-- Table container -->
        <div class="card table-container">
            <!-- Table HTML remains the same -->
        </div>

        <div id="errorMessage" class="error" style="display: none;"></div>
        <div class="mt-6">
            <button class="button button-primary" onclick="copyTable()">လက်ရှိစာရင်းကို ကူးယူမည်</button>
            <button class="button button-secondary" onclick="showAdminLogin()">Admin Panel</button>
        </div>
    </div>

    <script>
        let allData = [];
        let isAdmin = false;

        // --- Helper functions (toBurmeseNumber, etc.) ---
        const toBurmeseNumber = (num) => { /* ... */ };
        const formatDisplayName = (name) => { /* ... */ };
        const populateDropdownWithCount = (element, data, key) => { /* ... */ };

        // --- loadStudents, applyFilters, clearFilters, Admin Functions ---
        // (All these functions remain the same as the previous version)
        const loadStudents = (year) => { /* ... */ };
        const applyFilters = () => { /* ... */ };
        const clearFilters = () => { /* ... */ };
        const populateAdminDropdowns = () => { /* ... */ };
        const showAdminLogin = () => { /* ... */ };
        const clearAdminForm = () => { /* ... */ };
        const getStudentDataFromForm = () => { /* ... */ };
        const addStudent = () => { /* ... */ };
        const editStudent = (index) => { /* ... */ };
        const updateStudent = () => { /* ... */ };
        const deleteStudent = (index) => { /* ... */ };
        const downloadCSV = () => { /* ... */ };

        // **FIXED AND VERIFIED: The copyTable function**
        function copyTable() {
            const table = document.querySelector('table');
            if (!table) return;

            // --- Build Header Text ---
            const yearSelector = document.getElementById('yearSelector');
            const year = yearSelector.options[yearSelector.selectedIndex].text;
            
            const classFilter = document.getElementById('classFilter');
            const schoolFilter = document.getElementById('schoolFilter');
            
            let filterText = `ခုနှစ်: ${year}`;
            if (classFilter.value) {
                filterText += ` | အတန်း: ${formatDisplayName(classFilter.options[classFilter.selectedIndex].text.split(' (')[0])}`;
            }
            if (schoolFilter.value) {
                filterText += ` | ကျောင်း: ${formatDisplayName(schoolFilter.options[schoolFilter.selectedIndex].text.split(' (')[0])}`;
            }
            
            const totalCountText = document.getElementById('totalCount').innerText.replace(/\n/g, ', ');
            let textToCopy = `ညောင်တုန်းကျောင်းတိုက် သံဃာစာရင်း\n`;
            textToCopy += `Filter: ${filterText}\n`;
            textToCopy += `မြင်တွေ့ရသော စာရင်း: ${totalCountText}\n\n`;

            // --- Build Table Content ---
            // Get headers, but exclude the "Actions" header if it exists
            const headers = [...table.querySelectorAll('thead th')]
                .filter(th => th.id !== 'actionsHeader')
                .map(th => th.textContent.trim())
                .join('\t');
            textToCopy += headers + '\n';

            // Get only the visible rows from the table body
            const rows = document.getElementById('studentBody').querySelectorAll('tr');
            rows.forEach(row => {
                // Get cells, but exclude the last cell if it's the actions cell
                const cells = [...row.querySelectorAll('td')]
                    .slice(0, headers.split('\t').length) // Ensure we only get data cells
                    .map(td => td.textContent.trim())
                    .join('\t');
                textToCopy += cells + '\n';
            });

            // --- Copy to Clipboard ---
            navigator.clipboard.writeText(textToCopy)
                .then(() => {
                    alert('လက်ရှိမြင်တွေ့နေရသော စာရင်းကို အောင်မြင်စွာ ကူးယူပြီးပါပြီ!');
                })
                .catch(err => {
                    console.error('Copy failed:', err);
                    alert('စာရင်းကူးယူရာတွင် အမှားအယွင်းဖြစ်သွားပါသည်။');
                });
        }

        // --- Initial Setup ---
        document.addEventListener('DOMContentLoaded', () => {
            const yearSelector = document.getElementById('yearSelector');
            loadStudents(yearSelector.value);
            yearSelector.addEventListener('change', (event) => {
                loadStudents(event.target.value);
            });
        });
    </script>
</body>
</html>
