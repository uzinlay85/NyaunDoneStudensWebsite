<!DOCTYPE html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ညောင်တုန်းကျောင်းတိုက် သံဃာတော်များ</title>
    <script src="https://unpkg.com/papaparse@latest/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.cdnfonts.com/css/padauk' );
        body {
            font-family: 'Padauk', sans-serif;
            background-color: #f9fafb; /* Neutral, very light gray background */
            color: #374151; /* Slate 700 for primary text */
        }
        .container {
            max-width: 1280px;
            margin: auto;
            padding: 2rem;
        }
        .header {
            text-align: center;
            margin-bottom: 2rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb; /* Gray 200 */
            padding: 1.5rem;
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            margin-bottom: 1.5rem;
        }
        .table-container {
            overflow-x: auto;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }
        th, td {
            padding: 1rem 1.5rem; /* Increased padding for better spacing */
            text-align: left;
            border-bottom: 1px solid #e5e7eb; /* Gray 200 */
            vertical-align: middle; /* Ensure vertical alignment */
        }
        thead {
            background-color: #f3f4f6; /* Gray 100 */
        }
        th {
            font-weight: 600;
            color: #4b5563; /* Gray 600 */
            text-transform: uppercase;
            font-size: 0.8rem;
            letter-spacing: 0.05em;
        }
        tbody tr {
            transition: background-color 0.15s ease-in-out;
        }
        tbody tr:hover {
            background-color: #fafafa;
        }
        .filter-container {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
        }
        select {
            background-color: #ffffff;
            border: 1px solid #d1d5db; /* Gray 300 */
            border-radius: 0.5rem;
            padding: 0.6rem 1rem;
            color: #374151;
            transition: border-color 0.2s, box-shadow 0.2s;
        }
        select:focus {
            outline: none;
            border-color: #60a5fa; /* Blue 400 */
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.3);
        }
        .copy-button {
            background-color: #3b82f6; /* Blue 500 */
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            margin-top: 1.5rem;
            transition: background-color 0.2s, transform 0.1s;
        }
        .copy-button:hover {
            background-color: #2563eb; /* Blue 600 */
        }
        .copy-button:active {
            transform: scale(0.98);
        }
        .total-count {
            display: flex;
            justify-content: space-around;
            text-align: center;
        }
        .total-count .count-item span {
            font-size: 0.9rem;
            color: #6b7280; /* Gray 500 */
        }
        .total-count .count-item strong {
            display: block;
            font-size: 1.75rem;
            font-weight: 700;
            color: #1e40af; /* Blue 800 */
        }
        .error {
            color: #991b1b; /* Red 800 */
            margin-top: 1rem;
            background-color: #fee2e2; /* Red 100 */
            padding: 1rem;
            border-radius: 0.5rem;
            border: 1px solid #fca5a5; /* Red 300 */
        }
        /* Alignment specific classes */
        .text-center-cell { text-align: center; }
        .text-left-cell { text-align: left; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="text-3xl font-bold text-gray-800">ပါဠိတက္ကသိုလ်ညောင်တုန်းကျောင်းတိုက်</h1>
            <p class="text-lg text-gray-500 mt-1">၁၃၈၇ (၂၀၂၅) ခုနှစ် သံဃာစာရင်း</p>
        </div>

        <div class="card total-count" id="totalCount">
            <!-- JS will populate this -->
        </div>

        <div class="card">
            <div class="filter-container">
                <select id="classFilter" onChange="applyFilters()"><option value="">အတန်းအားလုံး</option></select>
                <select id="schoolFilter" onChange="applyFilters()"><option value="">ကျောင်းအားလုံး</option></select>
                <select id="subjectCountFilter" onChange="applyFilters()">
                    <option value="">ဘာသာရပ် အရေအတွက်</option>
                    <option value="4">၄ ဘာသာ</option>
                    <option value="3">၃ ဘာသာ</option>
                    <option value="2">၂ ဘာသာ</option>
                    <option value="1">၁ ဘာသာ</option>
                    <option value="custom">ဘာသာရပ်ဖြင့်ရှာရန်</option>
                </select>
                <select id="customSubjectFilter" style="display:none;" onChange="applyFilters()">
                    <option value="">ဘာသာရပ် ရွေးပါ</option>
                    <option value="P">ပါ</option><option value="TH">သီ</option><option value="N">ဏီ</option><option value="O">သစ်/ဟောင်း</option>
                </select>
            </div>
        </div>

        <div class="card table-container">
            <table>
                <thead>
                    <tr>
                        <th class="text-left-cell">စဉ်</th>
                        <th class="text-left-cell">နာမည်</th>
                        <th class="text-left-cell">အတန်း</th>
                        <th class="text-left-cell">ကျောင်း</th>
                        <th class="text-left-cell">ခုံနံပါတ်</th>
                        <th class="text-center-cell">ပါ</th>
                        <th class="text-center-cell">သီ</th>
                        <th class="text-center-cell">ဏီ</th>
                        <th class="text-center-cell">သစ်/ဟောင်း</th>
                    </tr>
                </thead>
                <tbody id="studentBody"></tbody>
            </table>
        </div>

        <div id="errorMessage" class="error" style="display: none;"></div>
        <button id="copyButton" class="copy-button" onclick="copyTable()">လက်ရှိစာရင်းကို ကူးယူမည်</button>
    </div>

    <script>
        let allData = [];

        const loadStudents = () => {
            const tableBody = document.getElementById('studentBody');
            const errorDiv = document.getElementById('errorMessage');
            const classFilter = document.getElementById('classFilter');
            const schoolFilter = document.getElementById('schoolFilter');

            fetch('students.csv')
                .then(response => {
                    if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
                    return response.text();
                })
                .then(csvText => {
                    Papa.parse(csvText, {
                        header: true, skipEmptyLines: true,
                        complete: (result) => {
                            if (result.errors.length) {
                                console.error('CSV parsing errors:', result.errors);
                                errorDiv.textContent = `CSV ဖိုင်ကို ဖတ်ရာတွင် အမှားအယွင်းများရှိနေပါသည်: ${result.errors[0].message}`;
                                errorDiv.style.display = 'block';
                            }
                            allData = result.data.map(row => ({
                                Name: row.Name || '', Class: row.Class || '', School: row.School || '',
                                C_Num: row.C_Num || '', P: row.P || '', TH: row.TH || '', N: row.N || '', O: row.O || ''
                            }));
                            const uniqueClasses = [...new Set(allData.map(s => s.Class).filter(Boolean))].sort();
                            const uniqueSchools = [...new Set(allData.map(s => s.School).filter(Boolean))].sort();
                            uniqueClasses.forEach(cls => classFilter.add(new Option(cls, cls)));
                            uniqueSchools.forEach(school => schoolFilter.add(new Option(school, school)));
                            applyFilters();
                        },
                        error: (error) => {
                            errorDiv.textContent = `CSV ဖိုင်ဖွင့်ရာတွင် အမှားဖြစ်ပါတယ်: ${error.message}`;
                            errorDiv.style.display = 'block';
                        }
                    });
                })
                .catch(error => {
                    errorDiv.textContent = `CSV ဖိုင်ကို ရှာမတွေ့ပါ သို့မဟုတ် ချိတ်ဆက်၍မရပါ: ${error.message}`;
                    errorDiv.style.display = 'block';
                });
        };

        const applyFilters = () => {
            const tableBody = document.getElementById('studentBody');
            const totalCountDiv = document.getElementById('totalCount');
            const classFilterValue = document.getElementById('classFilter').value;
            const schoolFilterValue = document.getElementById('schoolFilter').value;
            const subjectCountFilterValue = document.getElementById('subjectCountFilter').value;
            const customSubjectFilter = document.getElementById('customSubjectFilter');
            const customSubjectValue = customSubjectFilter.value;

            const filteredData = allData.filter(student => {
                const subjectCount = [student.P, student.TH, student.N, student.O].filter(Boolean).length;
                let subjectMatch = true;
                if (subjectCountFilterValue === 'custom' && customSubjectValue) {
                    subjectMatch = !!student[customSubjectValue];
                } else if (subjectCountFilterValue && subjectCountFilterValue !== 'custom') {
                    subjectMatch = subjectCount === parseInt(subjectCountFilterValue);
                }
                return (!classFilterValue || student.Class === classFilterValue) &&
                       (!schoolFilterValue || student.School === schoolFilterValue) &&
                       subjectMatch;
            });

            const monksCount = filteredData.filter(s => !s.Name.startsWith('ရှင်')).length;
            const novicesCount = filteredData.filter(s => s.Name.startsWith('ရှင်')).length;
            totalCountDiv.innerHTML = `
                <div class="count-item"><span>စုစုပေါင်း</span><strong>${filteredData.length} ပါး</strong></div>
                <div class="count-item"><span>ရဟန်း</span><strong>${monksCount} ပါး</strong></div>
                <div class="count-item"><span>သာမဏေ</span><strong>${novicesCount} ပါး</strong></div>`;
            
            tableBody.innerHTML = '';
            const sortedData = classFilterValue 
                ? [...filteredData].sort((a, b) => (parseInt(a.C_Num.replace(/\D/g,''), 10) || Infinity) - (parseInt(b.C_Num.replace(/\D/g,''), 10) || Infinity))
                : filteredData;

            if (sortedData.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="9" class="text-center text-gray-500 py-10">ရှာဖွေမှုနှင့် ကိုက်ညီသော အချက်အလက်များ မရှိပါ။</td></tr>`;
            } else {
                sortedData.forEach((student, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="text-left-cell text-gray-500">${index + 1}</td>
                        <td class="text-left-cell font-semibold text-gray-700">${student.Name}</td>
                        <td class="text-left-cell">${student.Class}</td>
                        <td class="text-left-cell">${student.School}</td>
                        <td class="text-left-cell">${student.C_Num}</td>
                        <td class="text-center-cell">${student.P ? '✅' : '—'}</td>
                        <td class="text-center-cell">${student.TH ? '✅' : '—'}</td>
                        <td class="text-center-cell">${student.N ? '✅' : '—'}</td>
                        <td class="text-center-cell">${student.O ? '✅' : '—'}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }
            customSubjectFilter.style.display = (subjectCountFilterValue === 'custom') ? 'inline-block' : 'none';
        };

        const copyTable = () => {
            const table = document.querySelector('table');
            const classFilter = document.getElementById('classFilter').value;
            const schoolFilter = document.getElementById('schoolFilter').value;
            const totalCountDiv = document.getElementById('totalCount');
            const total = totalCountDiv.querySelector('.count-item:nth-child(1) strong').textContent;
            const monks = totalCountDiv.querySelector('.count-item:nth-child(2) strong').textContent;
            const novices = totalCountDiv.querySelector('.count-item:nth-child(3) strong').textContent;
            let text = `ညောင်တုန်းကျောင်းတိုက် သံဃာစာရင်း (${classFilter || 'အတန်းအားလုံး'}${schoolFilter ? ', ' + schoolFilter : ''})\n`;
            text += `စုစုပေါင်း: ${total}, ရဟန်း: ${monks}, သာမဏေ: ${novices}\n\n`;
            const headers = [...table.querySelectorAll('th')].map(th => th.textContent).join('\t');
            text += headers + '\n';
            [...table.querySelectorAll('tbody tr')].forEach(row => {
                const cells = [...row.querySelectorAll('td')].map(td => td.textContent.replace('✅', 'Yes').replace('—', 'No'));
                text += cells.join('\t') + '\n';
            });
            navigator.clipboard.writeText(text)
                .then(() => alert('စာရင်းကို အောင်မြင်စွာ ကူးယူပြီးပါပြီ!'))
                .catch(err => {
                    console.error('Copy failed:', err);
                    alert('စာရင်းကူးယူရာတွင် အမှားအယွင်းဖြစ်သွားပါသည်။');
                });
        };

        window.onload = loadStudents;
    </script>
</body>
</html>
